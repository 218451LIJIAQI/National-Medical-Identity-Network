generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client/central"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_CENTRAL")
}

model Hospital {
  id          String  @id
  name        String
  shortName   String
  city        String
  state       String
  address     String
  phone       String
  email       String
  apiEndpoint String
  isActive    Boolean @default(true)

  // Relations
  users          User[]
  patientIndexes PatientIndexHospital[]
}

model PatientIndex {
  icNumber    String   @id
  lastUpdated DateTime @default(now())

  // Relations
  hospitals PatientIndexHospital[]
}

model PatientIndexHospital {
  id         String @id @default(uuid())
  icNumber   String
  hospitalId String

  patientIndex PatientIndex @relation(fields: [icNumber], references: [icNumber])
  hospital     Hospital     @relation(fields: [hospitalId], references: [id])

  @@unique([icNumber, hospitalId])
}

model User {
  id           String    @id @default(uuid())
  icNumber     String
  role         String // patient, doctor, hospital_admin, central_admin
  passwordHash String
  lastLogin    DateTime?
  isActive     Boolean   @default(true)

  // Relations (optional - only for hospital staff)
  hospitalId String?
  hospital   Hospital? @relation(fields: [hospitalId], references: [id])

  auditLogsAsActor AuditLog[]

  @@index([icNumber, role])
}

model PatientPrivacySetting {
  id         String  @id @default(uuid())
  icNumber   String
  hospitalId String
  isBlocked  Boolean @default(false)

  @@unique([icNumber, hospitalId])
}

model AuditLog {
  id               String   @id @default(uuid())
  timestamp        DateTime @default(now())
  action           String // query, view, create, update, login, logout
  actorType        String // doctor, patient, hospital_admin, central_admin, system
  actorHospitalId  String?
  targetIcNumber   String?
  targetHospitalId String?
  details          String?
  ipAddress        String?
  success          Boolean  @default(true)

  // Relations
  actorId String
  actor   User   @relation(fields: [actorId], references: [id])

  @@index([timestamp])
  @@index([targetIcNumber])
}
